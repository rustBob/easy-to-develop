{"version":3,"file":"SearchOverlay.js","sources":["components/SearchOverlay.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTovdnVlL-WltuiMtuWwj-eoi-W6jy9jb21wb25lbnRzL1NlYXJjaE92ZXJsYXkudnVl"],"sourcesContent":["<template>\n  <view v-if=\"visible\" class=\"search-overlay\">\n    <!-- Search Header -->\n    <view class=\"search-header\">\n      <view class=\"search-box\">\n        <text class=\"search-icon\">üîç</text>\n        <input \n            v-model=\"keyword\" \n            class=\"search-input\" \n            placeholder=\"ÊêúÁ¥¢ÂïÜÂìÅ\" \n            confirm-type=\"search\"\n            :focus=\"true\"\n            @confirm=\"onSearch\"\n            @input=\"onInput\"\n        />\n        <text v-if=\"keyword\" class=\"clear-icon\" @click=\"clearKeyword\">‚úï</text>\n      </view>\n      <text class=\"cancel-btn\" @click=\"close\">ÂèñÊ∂à</text>\n    </view>\n\n    <scroll-view scroll-y class=\"search-content\">\n        <!-- Search Results -->\n        <view v-if=\"keyword && showResults\" class=\"result-list\">\n            <view v-if=\"loading\" class=\"loading-state\">\n                <text>ÊêúÁ¥¢‰∏≠...</text>\n            </view>\n            <view v-else-if=\"results.length === 0\" class=\"empty-result\">\n                <text>Êú™ÊâæÂà∞Áõ∏ÂÖ≥ÂïÜÂìÅ</text>\n            </view>\n            <view v-else class=\"product-list\">\n                 <view \n                    v-for=\"prod in results\" \n                    :key=\"prod.id\" \n                    class=\"product-item\"\n                    @click=\"openProduct(prod)\"\n                  >\n                    <image :src=\"prod.image\" mode=\"aspectFill\" class=\"prod-img\" />\n                    <view class=\"prod-info\">\n                      <view>\n                        <rich-text :nodes=\"highlightName(prod.name)\" class=\"name\"></rich-text>\n                        <text class=\"desc\">{{ prod.description }}</text>\n                      </view>\n                      <view class=\"price-row\">\n                        <text class=\"price\">¬•{{ prod.price }}</text>\n                        <view class=\"add-btn\">\n                          <text class=\"plus\">+</text>\n                        </view>\n                      </view>\n                    </view>\n                  </view>\n            </view>\n        </view>\n\n        <!-- Search History & Hot Search -->\n        <view v-else>\n            <!-- History -->\n            <view class=\"section\" v-if=\"history.length > 0\">\n                <view class=\"section-header\">\n                    <text class=\"title\">ÂéÜÂè≤ÊêúÁ¥¢</text>\n                    <text class=\"delete-icon\" @click=\"clearHistory\">üóëÔ∏è</text>\n                </view>\n                <view class=\"tags\">\n                    <view v-for=\"(item, index) in history\" :key=\"index\" class=\"tag-item\" @click=\"quickSearch(item)\">\n                        {{ item }}\n                    </view>\n                </view>\n            </view>\n\n            <!-- Hot Search -->\n            <view class=\"section\">\n                <view class=\"section-header\">\n                    <text class=\"title\">ÁÉ≠Èó®ÊêúÁ¥¢</text>\n                </view>\n                <view class=\"tags\">\n                    <view v-for=\"(item, index) in hotSearches\" :key=\"index\" class=\"tag-item hot\" @click=\"quickSearch(item)\">\n                        <text class=\"fire-icon\" v-if=\"index < 3\">üî•</text>\n                        {{ item }}\n                    </view>\n                </view>\n            </view>\n        </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted, watch } from 'vue';\nimport { api } from '@/api/mock';\n\nconst props = defineProps({\n    visible: Boolean,\n    allProducts: {\n        type: Array,\n        default: () => []\n    }\n});\n\nconst emit = defineEmits(['update:visible', 'open-product']);\n\nconst keyword = ref('');\nconst history = ref([]);\nconst hotSearches = ref([]);\nconst results = ref([]);\nconst showResults = ref(false);\nconst loading = ref(false);\n\nonMounted(() => {\n    loadHistory();\n    loadHotSearches();\n});\n\n// Auto refresh hot searches every 2 hours\nsetInterval(() => {\n    loadHotSearches();\n}, 2 * 60 * 60 * 1000);\n\nconst loadHistory = () => {\n    const saved = uni.getStorageSync('search_history');\n    if (saved) {\n        history.value = JSON.parse(saved);\n    }\n};\n\nconst loadHotSearches = async () => {\n    try {\n        const data = await api.getHotSearches();\n        hotSearches.value = data.slice(0, 8);\n    } catch (e) {\n        console.error(e);\n    }\n};\n\nconst saveHistory = (kw) => {\n    if (!kw) return;\n    let newHistory = [...history.value];\n    // Remove if exists\n    const index = newHistory.indexOf(kw);\n    if (index > -1) {\n        newHistory.splice(index, 1);\n    }\n    // Add to front\n    newHistory.unshift(kw);\n    // Keep 10\n    if (newHistory.length > 10) {\n        newHistory = newHistory.slice(0, 10);\n    }\n    history.value = newHistory;\n    uni.setStorageSync('search_history', JSON.stringify(newHistory));\n};\n\nconst clearHistory = () => {\n    uni.showModal({\n        title: 'ÊèêÁ§∫',\n        content: 'Á°ÆÂÆöÊ∏ÖÁ©∫ÂéÜÂè≤ËÆ∞ÂΩïÂêóÔºü',\n        success: (res) => {\n            if (res.confirm) {\n                history.value = [];\n                uni.removeStorageSync('search_history');\n            }\n        }\n    });\n};\n\nconst close = () => {\n    emit('update:visible', false);\n    keyword.value = '';\n    showResults.value = false;\n};\n\nconst clearKeyword = () => {\n    keyword.value = '';\n    showResults.value = false;\n};\n\nconst onInput = (e) => {\n    // Real-time search debounce could be added here\n    const val = e.detail.value;\n    if (!val) {\n        showResults.value = false;\n        return;\n    }\n    performSearch(val);\n};\n\nconst onSearch = () => {\n    if (!keyword.value.trim()) return;\n    saveHistory(keyword.value.trim());\n    performSearch(keyword.value);\n};\n\nconst quickSearch = (kw) => {\n    keyword.value = kw;\n    saveHistory(kw);\n    performSearch(kw);\n};\n\nconst performSearch = (kw) => {\n    if (!kw) return;\n    loading.value = true;\n    showResults.value = true;\n    \n    // Simulate network delay\n    setTimeout(() => {\n        const lowerKw = kw.toLowerCase();\n        results.value = props.allProducts.filter(p => \n            p.name.toLowerCase().includes(lowerKw) || \n            p.description.toLowerCase().includes(lowerKw)\n        );\n        loading.value = false;\n    }, 300);\n};\n\nconst openProduct = (prod) => {\n    emit('open-product', prod);\n};\n\nconst addToCart = (prod) => {\n    // For direct add to cart from search list\n    // Since we need to open detail to choose specs, let's just open product\n    // Or if we want to bypass, we need default specs. \n    // Usually search list item click opens detail.\n    // The user said \"search products cannot be added to cart\", implies maybe the button + doesn't work or clicking item doesn't work.\n    // The current template has @click=\"openProduct(prod)\" on .product-item.\n    // But .add-btn inside doesn't have stopPropagation.\n    // Let's add @click.stop=\"openProduct(prod)\" to add-btn as well, or just let it bubble.\n    // Wait, the user said \"cannot return\", let's fix z-index first.\n    // And \"cannot add to cart\".\n    // If clicking the item opens the detail popup, then user can add to cart from there.\n    // If the detail popup is BEHIND the search overlay, then user can't interact.\n    // SearchOverlay z-index is 999.\n    // ProductDetail needs to be higher or SearchOverlay needs to close.\n    // If we close search overlay, user loses search context.\n    // Better to make ProductDetail z-index higher (e.g. 1000).\n};\n\nconst highlightName = (name) => {\n    if (!keyword.value) return [{ type: 'text', text: name }];\n    \n    const parts = name.split(new RegExp(`(${keyword.value})`, 'gi'));\n    return parts.map(part => {\n        if (part.toLowerCase() === keyword.value.toLowerCase()) {\n            return {\n                name: 'span',\n                attrs: { style: 'color: #ff6600; font-weight: bold;' },\n                children: [{ type: 'text', text: part }]\n            };\n        }\n        return { type: 'text', text: part };\n    });\n};\n\n</script>\n\n<style lang=\"scss\" scoped>\n.search-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: #fff;\n    z-index: 999;\n    display: flex;\n    flex-direction: column;\n}\n\n.search-header {\n    display: flex;\n    align-items: center;\n    padding: 20rpx 30rpx;\n    padding-right: 200rpx; // Avoid overlapping with Mini Program capsule button\n    padding-top: calc(20rpx + var(--status-bar-height)); // Adapt to status bar\n    border-bottom: 1px solid #f5f5f5;\n    background: #fff;\n    \n    .search-box {\n        flex: 1;\n        height: 72rpx;\n        background: #f5f5f5;\n        border-radius: 36rpx;\n        display: flex;\n        align-items: center;\n        padding: 0 24rpx;\n        margin-right: 20rpx;\n        \n        .search-icon { font-size: 28rpx; color: #999; margin-right: 12rpx; }\n        \n        .search-input {\n            flex: 1;\n            font-size: 28rpx;\n            color: #333;\n        }\n        \n        .clear-icon { font-size: 28rpx; color: #999; padding: 10rpx; }\n    }\n    \n    .cancel-btn {\n        font-size: 30rpx;\n        color: #666;\n        padding: 20rpx; // Add click area\n    }\n}\n\n.search-content {\n    flex: 1;\n    padding: 30rpx;\n    box-sizing: border-box;\n}\n\n.section {\n    margin-bottom: 50rpx;\n    \n    .section-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 24rpx;\n        \n        .title { font-size: 30rpx; font-weight: bold; color: #333; }\n        .delete-icon { font-size: 32rpx; opacity: 0.6; }\n    }\n    \n    .tags {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 20rpx;\n        \n        .tag-item {\n            padding: 12rpx 24rpx;\n            background: #f5f5f5;\n            border-radius: 30rpx;\n            font-size: 26rpx;\n            color: #666;\n            \n            &.hot {\n                color: #333;\n                .fire-icon { margin-right: 8rpx; font-size: 24rpx; }\n            }\n        }\n    }\n}\n\n.product-item {\n  display: flex;\n  margin-bottom: 30rpx;\n  \n  .prod-img {\n    width: 140rpx;\n    height: 140rpx;\n    border-radius: 12rpx;\n    margin-right: 20rpx;\n    background-color: #f5f5f5;\n  }\n  \n  .prod-info {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    padding: 4rpx 0;\n    \n    .name {\n      font-size: 28rpx;\n      font-weight: bold;\n      color: #333;\n      margin-bottom: 8rpx;\n    }\n    \n    .desc {\n      font-size: 22rpx;\n      color: #999;\n      display: -webkit-box;\n      -webkit-line-clamp: 1;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n    }\n    \n    .price-row {\n      display: flex;\n      justify-content: space-between;\n      align-items: flex-end;\n      \n      .price {\n        font-size: 32rpx;\n        font-weight: bold;\n        color: #333;\n      }\n      \n      .add-btn {\n        width: 44rpx;\n        height: 44rpx;\n        background-color: #ff6600;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        \n        .plus {\n          color: #fff;\n          font-size: 30rpx;\n          line-height: 1;\n          margin-top: -4rpx;\n        }\n      }\n    }\n  }\n}\n\n.loading-state, .empty-result {\n    padding-top: 100rpx;\n    text-align: center;\n    color: #999;\n    font-size: 28rpx;\n}\n</style>","import Component from 'E:/vue/Â•∂Ëå∂Â∞èÁ®ãÂ∫è/components/SearchOverlay.vue'\nwx.createComponent(Component)"],"names":["ref","onMounted","uni","api"],"mappings":"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"}