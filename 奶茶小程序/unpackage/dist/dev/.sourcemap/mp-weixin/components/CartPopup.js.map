{"version":3,"file":"CartPopup.js","sources":["components/CartPopup.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTovdnVlL-WltuiMtuWwj-eoi-W6jy9jb21wb25lbnRzL0NhcnRQb3B1cC52dWU"],"sourcesContent":["<template>\n  <view v-if=\"visible\" class=\"cart-mask\" @click=\"close\">\n    <view class=\"cart-content\" @click.stop>\n      <!-- Header -->\n      <view class=\"cart-header\">\n        <text class=\"title\">Ë¥≠Áâ©Ë¢ã</text>\n        <view class=\"clear-btn\" @click=\"clearCart\">\n          <text class=\"icon-trash\">üóë</text>\n          <text>Ê∏ÖÁ©∫</text>\n        </view>\n      </view>\n\n      <!-- List -->\n      <scroll-view scroll-y class=\"cart-list\">\n        <view v-for=\"(item, index) in cartStore.items\" :key=\"index\" class=\"cart-item\">\n          <view class=\"item-info\">\n            <text class=\"name\">{{ item.name }}</text>\n            <text class=\"specs\">{{ item.specs }}</text>\n          </view>\n          <view class=\"item-action\">\n            <text class=\"price\">¬•{{ item.price * item.drinksQuantity }}</text>\n            <view class=\"stepper\">\n              <view class=\"step-btn\" @click=\"updateQty(index, -1)\">-</view>\n              <text class=\"qty\">{{ item.drinksQuantity }}</text>\n              <view class=\"step-btn\" @click=\"updateQty(index, 1)\">+</view>\n            </view>\n          </view>\n        </view>\n      </scroll-view>\n\n      <!-- Footer Info -->\n      <view class=\"cart-footer-info\">\n         <view v-if=\"cartStore.orderType === 'delivery'\" class=\"discount-row\">\n            <text>ÈÖçÈÄÅË¥π</text>\n            <text class=\"amount\">¬•{{ cartStore.deliveryFee }}</text>\n         </view>\n         \n         <view v-if=\"userStore.isLoggedIn\" class=\"discount-row\">\n            <text>‰ºöÂëòÁ≠âÁ∫ßÊäòÊâ£ ({{ userStore.userInfo.levelName }})</text>\n            <text class=\"amount\">-¬•{{ cartStore.levelDiscountAmount }}</text>\n         </view>\n         \n         <view v-if=\"userStore.isLoggedIn && cartStore.couponDiscountAmount > 0\" class=\"discount-row\">\n             <text>‰ºòÊÉ†Âà∏ÊäµÊâ£</text>\n             <text class=\"amount\">-¬•{{ cartStore.couponDiscountAmount }}</text>\n         </view>\n\n         <view class=\"points-row\">\n            <text>ÁßØÂàÜÊäµÊâ£ (ÂèØÁî®{{ userStore.userInfo.points }})</text>\n            <label class=\"checkbox-label\">\n                <checkbox :checked=\"cartStore.usePoints\" @click=\"togglePoints\" style=\"transform:scale(0.7)\" color=\"#ff6600\"/>\n                <text>ÊäµÊâ£ ¬•{{ cartStore.pointsDeduction }}</text>\n            </label>\n         </view>\n      </view>\n\n      <!-- Coupon Selector -->\n      <scroll-view scroll-x class=\"coupon-scroll\" v-if=\"userStore.isLoggedIn && coupons && coupons.length > 0\">\n          <view v-for=\"c in coupons\" :key=\"c.id\" \n                class=\"coupon-tag\" \n                :class=\"{ active: cartStore.selectedCouponId === c.id, disabled: cartStore.originalTotal < c.minAmount }\"\n                @click=\"selectCoupon(c)\">\n              <text class=\"name\">{{ c.name }}</text>\n              <text class=\"tip\" v-if=\"cartStore.originalTotal < c.minAmount\">Â∑Æ¬•{{ (c.minAmount - cartStore.originalTotal).toFixed(1) }}</text>\n          </view>\n      </scroll-view>\n\n      <!-- Remarks -->\n      <view class=\"remarks-section\">\n          <view class=\"section-header\">\n              <text class=\"title\">Â§áÊ≥®</text>\n              <text class=\"count\">{{ remarks.length }}/200</text>\n          </view>\n          <textarea \n              v-model=\"remarks\" \n              class=\"remarks-input\" \n              placeholder=\"ËØ∑ËæìÂÖ•ÁâπÊÆäË¶ÅÊ±ÇÊàñÂ§áÊ≥®‰ø°ÊÅØÔºàÈÄâÂ°´Ôºâ\" \n              maxlength=\"200\"\n              :disable-default-padding=\"true\"\n          />\n      </view>\n\n      <!-- Checkout Button -->\n      <view class=\"checkout-bar\" @click=\"submitOrder\">\n        <view class=\"total\">\n          <text class=\"symbol\">¬•</text>\n          <text class=\"num\">{{ cartStore.finalTotal }}</text>\n        </view>\n        <view class=\"pay-btn\">\n          <text>ÂéªÊîØ‰ªò</text>\n          <image src=\"/static/enter-arrow.png\" class=\"arrow\" />\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { computed, watch, onUnmounted, ref } from 'vue';\nimport { useCartStore } from '@/store/cart';\nimport { useUserStore } from '@/store/user';\n\nconst props = defineProps({\n  visible: Boolean\n});\n\nconst emit = defineEmits(['update:visible', 'submit']);\n\nconst cartStore = useCartStore();\nconst userStore = useUserStore();\n\nconst remarks = ref('');\n\nconst coupons = computed(() => (userStore.userInfo && userStore.userInfo.couponList) ? userStore.userInfo.couponList : []);\n\n// Watch visible to toggle TabBar\nwatch(() => props.visible, (val) => {\n  if (val) {\n    uni.hideTabBar();\n  } else {\n    uni.showTabBar();\n  }\n});\n\n// Restore TabBar on unmount\nonUnmounted(() => {\n    uni.showTabBar();\n});\n\nconst close = () => {\n  emit('update:visible', false);\n};\n\nconst clearCart = () => {\n  cartStore.clearCart();\n  remarks.value = '';\n  close();\n};\n\nconst updateQty = (index, delta) => {\n  cartStore.updateQty(index, delta);\n  if (cartStore.items.length === 0) {\n    remarks.value = '';\n    close();\n  }\n};\n\nconst togglePoints = () => {\n  cartStore.usePoints = !cartStore.usePoints;\n};\n\nconst selectCoupon = (coupon) => {\n    if (cartStore.originalTotal < coupon.minAmount) return;\n    cartStore.selectCoupon(coupon.id);\n};\n\nconst submitOrder = () => {\n  // Simple XSS filter or trim\n  const cleanRemarks = remarks.value.trim().replace(/<[^>]*>?/gm, '');\n  emit('submit', { remarks: cleanRemarks });\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.cart-mask {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  z-index: 1002;\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-end;\n}\n\n.cart-content {\n  background-color: #fff;\n  border-top-left-radius: 24rpx;\n  border-top-right-radius: 24rpx;\n  padding: 30rpx;\n  padding-bottom: calc(60rpx + env(safe-area-inset-bottom));\n  max-height: 80vh;\n  display: flex;\n  flex-direction: column;\n}\n\n.cart-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-bottom: 20rpx;\n  border-bottom: 1px solid #eee;\n  \n  .title {\n    font-size: 32rpx;\n    font-weight: bold;\n  }\n  \n  .clear-btn {\n    font-size: 24rpx;\n    color: #999;\n    display: flex;\n    align-items: center;\n    gap: 8rpx;\n  }\n}\n\n.cart-list {\n  flex: 1;\n  max-height: 500rpx;\n  margin-bottom: 20rpx;\n}\n\n.cart-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20rpx 0;\n  \n  .item-info {\n    flex: 1;\n    \n    .name {\n      font-size: 30rpx;\n      font-weight: bold;\n      color: #333;\n      display: block;\n    }\n    \n    .specs {\n      font-size: 22rpx;\n      color: #999;\n    }\n  }\n  \n  .item-action {\n    display: flex;\n    align-items: center;\n    gap: 20rpx;\n    \n    .price {\n      font-weight: bold;\n      font-size: 30rpx;\n    }\n  }\n}\n\n.stepper {\n  display: flex;\n  align-items: center;\n  border: 1px solid #ddd;\n  border-radius: 8rpx;\n  \n  .step-btn {\n    width: 50rpx;\n    height: 50rpx;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: #666;\n  }\n  \n  .qty {\n    width: 40rpx;\n    text-align: center;\n    font-size: 24rpx;\n  }\n}\n\n.cart-footer-info {\n  background: #fff5e6;\n  padding: 20rpx;\n  border-radius: 12rpx;\n  margin-bottom: 20rpx;\n  font-size: 24rpx;\n  \n  .discount-row, .points-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10rpx;\n    color: #666;\n  }\n  \n  .amount {\n    color: #ff6600;\n    font-weight: bold;\n  }\n  \n  .checkbox-label {\n    display: flex;\n    align-items: center;\n  }\n}\n\n.coupon-scroll {\n    white-space: nowrap;\n    margin-bottom: 20rpx;\n    \n    .coupon-tag {\n        display: inline-block;\n        padding: 10rpx 20rpx;\n        background: #f5f5f5;\n        border: 1px solid #eee;\n        border-radius: 8rpx;\n        margin-right: 20rpx;\n        font-size: 24rpx;\n        color: #666;\n        \n        &.active {\n            background: #fff5e6;\n            border-color: #ff6600;\n            color: #ff6600;\n        }\n        \n        &.disabled {\n            opacity: 0.5;\n            background: #eee;\n        }\n        \n        .tip {\n            font-size: 20rpx;\n            color: #ff4d4f;\n            margin-left: 8rpx;\n        }\n    }\n}\n\n.remarks-section {\n  margin-bottom: 30rpx;\n  background: #f9f9f9;\n  padding: 20rpx;\n  border-radius: 12rpx;\n  \n  .section-header {\n      display: flex;\n      justify-content: space-between;\n      margin-bottom: 12rpx;\n      \n      .title { font-size: 26rpx; font-weight: bold; color: #333; }\n      .count { font-size: 22rpx; color: #999; }\n  }\n  \n  .remarks-input {\n      width: 100%;\n      height: 120rpx;\n      font-size: 26rpx;\n      color: #333;\n      line-height: 1.4;\n  }\n}\n\n.checkout-bar {\n  background: #ff6600;\n  color: #fff;\n  padding: 24rpx 40rpx;\n  border-radius: 50rpx;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  box-shadow: 0 4rpx 12rpx rgba(255, 102, 0, 0.3);\n  \n  .total {\n    .symbol { font-size: 24rpx; }\n    .num { font-size: 36rpx; font-weight: bold; }\n  }\n  \n  .pay-btn {\n    display: flex;\n    align-items: center;\n    font-weight: bold;\n    font-size: 30rpx;\n    \n    .arrow { margin-left: 10rpx; width: 24rpx; height: 24rpx; }\n  }\n}\n</style>\n","import Component from 'E:/vue/Â•∂Ëå∂Â∞èÁ®ãÂ∫è/components/CartPopup.vue'\nwx.createComponent(Component)"],"names":["useCartStore","useUserStore","ref","computed","watch","uni","onUnmounted"],"mappings":";;;;;;;;;;;;AAsGA,UAAM,QAAQ;AAId,UAAM,OAAO;AAEb,UAAM,YAAYA,WAAY,aAAA;AAC9B,UAAM,YAAYC,WAAY,aAAA;AAE9B,UAAM,UAAUC,cAAAA,IAAI,EAAE;AAEtB,UAAM,UAAUC,cAAAA,SAAS,MAAO,UAAU,YAAY,UAAU,SAAS,aAAc,UAAU,SAAS,aAAa,CAAE,CAAA;AAGzHC,kBAAK,MAAC,MAAM,MAAM,SAAS,CAAC,QAAQ;AAClC,UAAI,KAAK;AACPC,sBAAG,MAAC,WAAU;AAAA,MAClB,OAAS;AACLA,sBAAG,MAAC,WAAU;AAAA,MACf;AAAA,IACH,CAAC;AAGDC,kBAAAA,YAAY,MAAM;AACdD,oBAAG,MAAC,WAAU;AAAA,IAClB,CAAC;AAED,UAAM,QAAQ,MAAM;AAClB,WAAK,kBAAkB,KAAK;AAAA,IAC9B;AAEA,UAAM,YAAY,MAAM;AACtB,gBAAU,UAAS;AACnB,cAAQ,QAAQ;AAChB;IACF;AAEA,UAAM,YAAY,CAAC,OAAO,UAAU;AAClC,gBAAU,UAAU,OAAO,KAAK;AAChC,UAAI,UAAU,MAAM,WAAW,GAAG;AAChC,gBAAQ,QAAQ;AAChB;MACD;AAAA,IACH;AAEA,UAAM,eAAe,MAAM;AACzB,gBAAU,YAAY,CAAC,UAAU;AAAA,IACnC;AAEA,UAAM,eAAe,CAAC,WAAW;AAC7B,UAAI,UAAU,gBAAgB,OAAO;AAAW;AAChD,gBAAU,aAAa,OAAO,EAAE;AAAA,IACpC;AAEA,UAAM,cAAc,MAAM;AAExB,YAAM,eAAe,QAAQ,MAAM,KAAM,EAAC,QAAQ,cAAc,EAAE;AAClE,WAAK,UAAU,EAAE,SAAS,aAAc,CAAA;AAAA,IAC1C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/JA,GAAG,gBAAgB,SAAS;"}