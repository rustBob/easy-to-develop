{"version":3,"file":"after-sales.js","sources":["pages/after-sales/after-sales.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWZ0ZXItc2FsZXMvYWZ0ZXItc2FsZXMudnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <view class=\"order-info\">\n        <text class=\"label\">ËÆ¢ÂçïÁºñÂè∑Ôºö</text>\n        <text class=\"value\">{{ orderId }}</text>\n    </view>\n\n    <view class=\"status-bar\" v-if=\"status\">\n        <text class=\"status-text\">{{ getStatusText(status) }}</text>\n        <text class=\"status-desc\" v-if=\"status === 3\">ÂïÜÂÆ∂Â∑≤ÊãíÁªùÔºåËØ∑‰øÆÊîπÂêéÈáçÊñ∞Êèê‰∫§</text>\n    </view>\n\n    <view class=\"type-select\" :class=\"{ disabled: status === 1 || status === 2 }\">\n        <view class=\"section-title\">ÈÄâÊã©ÂîÆÂêéÁ±ªÂûã</view>\n        <view class=\"options\">\n            <view class=\"option\" :class=\"{active: type === 1}\" @click=\"status !== 1 && status !== 2 && (type = 1)\">\n                <text class=\"icon\">üí∞</text>\n                <text>Áî≥ËØ∑ÈÄÄÊ¨æ</text>\n            </view>\n            <view class=\"option\" :class=\"{active: type === 2}\" @click=\"status !== 1 && status !== 2 && (type = 2)\">\n                <text class=\"icon\">üìù</text>\n                <text>ÊäïËØâÂª∫ËÆÆ</text>\n            </view>\n        </view>\n    </view>\n\n    <view class=\"form-content\">\n        <view class=\"section-title\">ÈóÆÈ¢òÊèèËø∞</view>\n        <textarea \n            class=\"textarea\" \n            v-model=\"reason\" \n            placeholder=\"ËØ∑ËØ¶ÁªÜÊèèËø∞ÊÇ®ÈÅáÂà∞ÁöÑÈóÆÈ¢ò...\" \n            maxlength=\"200\"\n            :disabled=\"status === 1 || status === 2\"\n        ></textarea>\n        <text class=\"word-count\">{{ reason.length }}/200</text>\n        \n        <view class=\"upload-box\">\n            <view class=\"upload-btn\" @click=\"chooseImage\" v-if=\"status !== 1 && status !== 2\">\n                <text class=\"plus\">+</text>\n                <text class=\"text\">‰∏ä‰º†Âá≠ËØÅ</text>\n            </view>\n            <view v-for=\"(img, index) in images\" :key=\"index\" class=\"img-preview\">\n                <image :src=\"img\" mode=\"aspectFill\" class=\"img\" />\n                <text class=\"del\" @click=\"removeImage(index)\" v-if=\"status !== 1 && status !== 2\">√ó</text>\n            </view>\n        </view>\n    </view>\n\n    <button class=\"submit-btn\" @click=\"submit\" v-if=\"!status || status === 3\">Êèê‰∫§Áî≥ËØ∑</button>\n    <button class=\"submit-btn cancel\" @click=\"cancel\" v-if=\"status === 1\">ÂèñÊ∂àÁî≥ËØ∑</button>\n  </view>\n</template>\n\n<script setup>\nimport { ref } from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\nimport { globalApi } from '@/api/globalApi';\nimport { upload } from '@/api/file.js';\n\nconst orderId = ref('');\nconst type = ref(1); // refund | complaint\nconst reason = ref('');\nconst images = ref([]);\nconst status = ref();\nconst recordId = ref();\n\nonLoad((options) => {\n    if (options.orderId) {\n        orderId.value = options.orderId;\n        globalApi['after-sales'].get(null, {\n            orderId: orderId.value\n        },(res) => {\n            const data = res[0]\n            if(data){\n                recordId.value = data.id;\n                type.value = data.type;\n                images.value = data.images || [];\n                reason.value = data.description || '';\n                status.value = data.status; // 1: Pending, 2: Approved, 3: Rejected\n            }\n        })\n    }\n});\n\nconst getStatusText = (s) => {\n    switch(s) {\n        case 1: return 'ÂæÖÂÆ°Êâπ';\n        case 2: return 'Â∑≤ÂêåÊÑè';\n        case 3: return 'Â∑≤ÊãíÁªù';\n        default: return '';\n    }\n};\n\nconst chooseImage = () => {\n    if (status.value === 1 || status.value === 2) return;\n    uni.chooseImage({\n        count: 3 - images.value.length,\n        sizeType: ['original', 'compressed'],\n        sourceType: ['album', 'camera'],\n        success: async (res) => {\n            uni.showLoading({ title: '‰∏ä‰º†‰∏≠...', mask: true });\n            try {\n                const uploadTasks = res.tempFiles.map(file => {\n                    return upload([{\n                        ...file,\n                        name: Date.now() + '-aftersales'\n                    }]);\n                });\n                \n                const results = await Promise.all(uploadTasks);\n                const newImages = results\n                    .filter(r => r.code === 200 && r.data && r.data.length > 0)\n                    .map(r => r.data[0]);\n                \n                if (newImages.length > 0) {\n                    images.value = [...images.value, ...newImages];\n                } else {\n                    uni.showToast({ title: 'ÂõæÁâá‰∏ä‰º†Â§±Ë¥•', icon: 'none' });\n                }\n            } catch (e) {\n                console.error(e);\n                uni.showToast({ title: '‰∏ä‰º†ÂºÇÂ∏∏', icon: 'none' });\n            } finally {\n                uni.hideLoading();\n            }\n        }\n    });\n};\n\nconst removeImage = (index) => {\n    if (status.value === 1 || status.value === 2) return;\n    images.value.splice(index, 1);\n};\n\nconst cancel = () => {\n    uni.showModal({\n        title: 'ÊèêÁ§∫',\n        content: 'Á°ÆÂÆöË¶ÅÂèñÊ∂àÂîÆÂêéÁî≥ËØ∑ÂêóÔºü',\n        success: (res) => {\n            if (res.confirm) {\n                globalApi['after-sales'].delete(null, {id: recordId.value}, () => {\n                    uni.showToast({ title: 'Â∑≤ÂèñÊ∂à' });\n                    setTimeout(() => {\n                        uni.navigateBack();\n                    }, 1500);\n                });\n            }\n        }\n    });\n};\n\nconst submit = () => {\n    if (!reason.value.trim()) {\n        uni.showToast({ title: 'ËØ∑ËæìÂÖ•ÈóÆÈ¢òÊèèËø∞', icon: 'none' });\n        return;\n    }\n    \n    uni.showLoading({ title: 'Êèê‰∫§‰∏≠' });\n    \n    const data = {\n        orderId: orderId.value,\n        type: type.value,\n        description: reason.value,\n        images: images.value,\n        status: 1 // Reset to pending\n    };\n\n    const apiCall = recordId.value \n        ? globalApi['after-sales'].update({pk1: recordId.value}, data) \n        : globalApi['after-sales'].add(null, data);\n\n    apiCall.then(res => {\n        uni.hideLoading();\n        uni.showToast({ title: 'Êèê‰∫§ÊàêÂäü' });\n        setTimeout(() => {\n            uni.navigateBack();\n        }, 1500);\n    });\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  min-height: 100vh;\n  background-color: #f8f8f8;\n  padding: 30rpx;\n  box-sizing: border-box;\n}\n\n.status-bar {\n    background: #e6f7ff;\n    border: 1px solid #91d5ff;\n    padding: 20rpx;\n    border-radius: 12rpx;\n    margin-bottom: 30rpx;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    \n    .status-text { color: #1890ff; font-weight: bold; }\n    .status-desc { font-size: 24rpx; color: #666; }\n}\n\n.order-info {\n    background: #fff;\n    padding: 24rpx;\n    border-radius: 12rpx;\n    margin-bottom: 30rpx;\n    font-size: 28rpx;\n    color: #666;\n    \n    .value { color: #333; font-weight: bold; margin-left: 10rpx; }\n}\n\n.section-title {\n    font-size: 30rpx;\n    font-weight: bold;\n    color: #333;\n    margin-bottom: 20rpx;\n}\n\n.type-select {\n    background: #fff;\n    padding: 30rpx;\n    border-radius: 12rpx;\n    margin-bottom: 30rpx;\n    \n    &.disabled { opacity: 0.7; pointer-events: none; }\n    \n    .options {\n        display: flex;\n        gap: 30rpx;\n        \n        .option {\n            flex: 1;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            padding: 30rpx;\n            border: 2px solid #eee;\n            border-radius: 12rpx;\n            color: #666;\n            font-size: 28rpx;\n            \n            .icon { font-size: 48rpx; margin-bottom: 10rpx; }\n            \n            &.active {\n                border-color: #ff6600;\n                color: #ff6600;\n                background: #fff5e6;\n            }\n        }\n    }\n}\n\n.form-content {\n    background: #fff;\n    padding: 30rpx;\n    border-radius: 12rpx;\n    margin-bottom: 60rpx;\n    \n    .textarea {\n        width: 100%;\n        height: 200rpx;\n        background: #f9f9f9;\n        padding: 20rpx;\n        border-radius: 8rpx;\n        font-size: 28rpx;\n        box-sizing: border-box;\n    }\n    \n    .word-count {\n        display: block;\n        text-align: right;\n        font-size: 24rpx;\n        color: #999;\n        margin: 10rpx 0 30rpx;\n    }\n    \n    .upload-box {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 20rpx;\n        \n        .upload-btn {\n            width: 160rpx;\n            height: 160rpx;\n            background: #f9f9f9;\n            border: 1px dashed #ddd;\n            border-radius: 8rpx;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            color: #999;\n            \n            .plus { font-size: 60rpx; line-height: 1; margin-bottom: 10rpx; }\n            .text { font-size: 24rpx; }\n        }\n        \n        .img-preview {\n            width: 160rpx;\n            height: 160rpx;\n            position: relative;\n            \n            .img { width: 100%; height: 100%; border-radius: 8rpx; }\n            .del {\n                position: absolute;\n                top: -10rpx;\n                right: -10rpx;\n                width: 36rpx;\n                height: 36rpx;\n                background: rgba(0,0,0,0.5);\n                color: #fff;\n                border-radius: 50%;\n                text-align: center;\n                line-height: 34rpx;\n                font-size: 24rpx;\n            }\n        }\n    }\n}\n\n.submit-btn {\n    background: #ff6600;\n    color: #fff;\n    border-radius: 44rpx;\n    font-size: 32rpx;\n    font-weight: bold;\n    \n    &.cancel {\n        background: #fff;\n        color: #666;\n        border: 1px solid #ddd;\n        margin-top: 20rpx;\n    }\n}\n</style>","import MiniProgramPage from 'E:/vue/Â•∂Ëå∂Â∞èÁ®ãÂ∫è/pages/after-sales/after-sales.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","globalApi","uni","upload"],"mappings":"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"}