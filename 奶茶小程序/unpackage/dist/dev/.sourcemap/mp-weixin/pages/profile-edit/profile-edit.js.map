{"version":3,"file":"profile-edit.js","sources":["pages/profile-edit/profile-edit.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZmlsZS1lZGl0L3Byb2ZpbGUtZWRpdC52dWU"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <view class=\"form-card\">\n      <view class=\"form-item\">\n        <text class=\"label\">头像</text>\n        <view class=\"avatar-wrap\" @click=\"changeAvatar\">\n            <image :src=\"form.avatar\" mode=\"aspectFill\" class=\"avatar\" />\n        </view>\n      </view>\n      \n      <view class=\"form-item\">\n        <text class=\"label\">用户名</text>\n        <input class=\"input disabled\" :value=\"form.username\" disabled />\n      </view>\n\n      <view class=\"form-item\">\n        <text class=\"label\">昵称</text>\n        <input class=\"input\" v-model=\"form.nickname\" placeholder=\"请输入昵称\" />\n      </view>\n\n      <view class=\"form-item\">\n        <text class=\"label\">手机号</text>\n        <input class=\"input\" v-model=\"form.phone\" type=\"number\" maxlength=\"11\" placeholder=\"请输入手机号\" />\n      </view>\n    </view>\n    \n    <view class=\"action-bar\">\n        <button class=\"btn cancel\" @click=\"goBack\">取消</button>\n        <button class=\"btn save\" @click=\"handleSave\" :loading=\"loading\">保存</button>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, reactive, onMounted } from 'vue';\nimport { useUserStore } from '@/store/user';\nimport { globalApi } from '@/api/globalApi/index.js';\nimport { upload } from '@/api/file.js';\n\nconst userStore = useUserStore();\nconst loading = ref(false);\n\nconst form = reactive({\n    id: '',\n    username: '',\n    nickname: '',\n    phone: '',\n    email: '',\n    avatar: ''\n});\n\nlet avatarFile = null;\n\nonMounted(() => {\n    if (userStore.userInfo) {\n        form.id = userStore.userInfo.id;\n        form.username = userStore.userInfo.username || userStore.userInfo.nickname; // Fallback\n        form.nickname = userStore.userInfo.nickname;\n        form.phone = userStore.userInfo.phone || '';\n        form.email = userStore.userInfo.email || '';\n        form.avatar = userStore.userInfo.avatar;\n    }\n});\n\nconst changeAvatar = () => {\n    uni.chooseImage({\n        count: 1,\n        sizeType: ['original', 'compressed'],\n        sourceType: ['album', 'camera'],\n        success: (res) => {\n            form.avatar = res.tempFilePaths[0];\n            avatarFile = {\n                ...res.tempFiles[0],\n                name: Date.now() + '-avatar'\n            };\n        },\n        fail: (err) => {\n            console.error('选择图片失败：', err);\n            uni.showToast({\n                title: '选择图片失败或取消了选择',\n                icon: 'none'\n            });\n        }\n    });\n};\n\nconst validate = () => {\n    if (!form.nickname.trim()) {\n        uni.showToast({ title: '请输入昵称', icon: 'none' });\n        return false;\n    }\n    if (form.phone && !/^1[3-9]\\d{9}$/.test(form.phone)) {\n        uni.showToast({ title: '手机号格式不正确', icon: 'none' });\n        return false;\n    }\n    return true;\n};\n\nconst handleSave = async () => {\n    if (!validate()) return;\n\n    uni.showModal({\n        title: '确认修改',\n        content: '确定继续吗？',\n        success: async (res) => {\n            if (res.confirm) {\n                if (avatarFile) {\n                    uni.showLoading({ title: '上传图片中...', mask: true })\n                    const res = await upload([avatarFile]);\n                    \n                    if (res.code !== 200) {\n                        uni.hideLoading();\n                        uni.showToast({\n                            title: '文件上传失败',\n                            icon: 'none'\n                        });\n                        return;\n                    }\n                    form.avatar = res.data[0];\n                    uni.hideLoading()\n                }\n                submitData();\n            }\n        }\n    });\n};\n\nconst submitData = async () => {\n    loading.value = true;\n    try {\n        const updateData = {\n            id: form.id,\n            nickname: form.nickname,\n            phone: form.phone,\n            avatar: form.avatar\n        };\n        \n        // Call API\n        await globalApi['users'].update(null, updateData, (res) => {\n             userStore.updateUserInfo(updateData);\n             uni.showToast({ title: '保存成功' });\n             setTimeout(() => {\n                 uni.navigateBack();\n             }, 1500);\n        }, (err) => {\n             uni.showToast({ title: err.msg || '保存失败', icon: 'none' });\n        });\n        \n    } catch (e) {\n        uni.showToast({ title: '保存失败', icon: 'none' });\n    } finally {\n        loading.value = false;\n    }\n};\n\nconst goBack = () => {\n    uni.navigateBack();\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  min-height: 100vh;\n  background-color: #f8f8f8;\n  padding: 30rpx;\n  box-sizing: border-box;\n}\n\n.form-card {\n    background: #fff;\n    border-radius: 16rpx;\n    padding: 0 30rpx;\n    margin-bottom: 60rpx;\n}\n\n.form-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 30rpx 0;\n    border-bottom: 1px solid #f5f5f5;\n    \n    &:last-child { border-bottom: none; }\n    \n    .label {\n        font-size: 30rpx;\n        color: #333;\n        width: 160rpx;\n    }\n    \n    .input {\n        flex: 1;\n        text-align: right;\n        font-size: 30rpx;\n        color: #333;\n        \n        &.disabled {\n            color: #999;\n        }\n    }\n    \n    .avatar-wrap {\n        display: flex;\n        align-items: center;\n        \n        .avatar {\n            width: 80rpx;\n            height: 80rpx;\n            border-radius: 50%;\n            margin-right: 10rpx;\n            background: #eee;\n        }\n        \n        .arrow {\n            color: #ccc;\n            font-size: 30rpx;\n        }\n    }\n}\n\n.action-bar {\n    display: flex;\n    justify-content: space-between;\n    gap: 30rpx;\n    \n    .btn {\n        flex: 1;\n        height: 88rpx;\n        line-height: 88rpx;\n        text-align: center;\n        border-radius: 44rpx;\n        font-size: 32rpx;\n        font-weight: bold;\n        \n        &.cancel {\n            background: #fff;\n            color: #666;\n            border: 1px solid #ddd;\n        }\n        \n        &.save {\n            background: #ff6600;\n            color: #fff;\n            border: none;\n        }\n    }\n}\n</style>","import MiniProgramPage from 'E:/vue/奶茶小程序/pages/profile-edit/profile-edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserStore","ref","reactive","onMounted","uni","res","upload","globalApi"],"mappings":"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"}